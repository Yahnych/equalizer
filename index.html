<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Equalizer</title>
    <style>
      * { margin: 0; padding: 0; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        font-size: 14px;
        line-height: 1.5;
        text-align: center;
      }
      svg, canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="scripts">
      <script src="./third-party/two.js"></script>
      <script src="./third-party/sound.js"></script>
      <script src="./src/equalizer.js"></script>
      <script>

        var equalizer = new Equalizer().appendTo(document.body);
        var elem = equalizer.domElement;
        var sound;

        elem.style.display = 'inline-block';
        elem.style.margin = '20px';
        elem.style.border = '1px solid #ccc';

        elem.addEventListener('drop', function(e) {

          e.stopPropagation();
          e.preventDefault();

          elem.style.background = 'transparent';
          var file = e.dataTransfer.files[0];

          if (!file) {
            return;
          }

          var reader = new FileReader();
          reader.onload = function(e) {
            var data = e.target.result;
            if (sound) {
              sound.stop();
            }
            sound = new Sound(data, setup);
            equalizer.reset();
          };

          reader.readAsArrayBuffer(file);

        }, false);
        elem.addEventListener('dragover', function(e) {
          e.stopPropagation();
          e.preventDefault();
          elem.style.background = 'rgba(200, 255, 150, 0.33)';
        }, false);
        elem.addEventListener('dragleave', function(e) {
          e.stopPropagation();
          e.preventDefault();
          elem.style.background = 'transparent';
        });

        equalizer.update();

        function setup() {
          equalizer.analyze(sound);
          sound.play();
          if (!loop.init) {
            loop();
            loop.init = true;
          }
        }

        function loop() {
          requestAnimationFrame(loop);
          equalizer.update();
        }

      </script>
    </div>
  </body>
</html>
